# lecture13:講義概要
## 【概要】
インフラの自動構築を実現するにあたり、狂いなく正常な処理が実現されるように構築される必要がある。  
当然、前講義のツールだけでは完全な再現が難しくあるため、構成管理ツールを踏まえて実現性を確認していく。頻繁に耳にする Ansible を取り上げて、理解を深めていく。  
  
## ○構成管理(プロビジョニング)ツール
一つのインフラとしてアプリケーションを動作させる為の処理を自動実行する仕組みを提供するツール。
有名なものとして Chef、Puppet、Ansible です。また Chef や Puppet を利用する OpsWorks 。
  
構成管理ツールは冪等(べきとう)性を備えており、「何を実行するか」ではなく「どういう状態にするか」を定義して実現するためのさまざまなモジュールが提供されている。  
つまり、設定済みであるものに対しては例外（エラー）とならずにスキップされる。  
  
### エージェント型[ChefやPuppet]
- 構成管理を行う対象のサーバーに対してエージェントと呼ばれる通信を行う為のモジュールを事前に導入しておく必要がある。
- 利用するためにはエージェントを入れたサーバーとそれらを管理するサーバーがそれぞれ必要にな
り、環境設定などはそのエージェント経由で行う、という形になる。
また両方とも Ruby で構築されていること、専用の DSL(ドメイン固有言語)を理解する必要があり学習コストが高い。  

### 非エージェント型[Ansible]
- 事前にモジュールを導入する必要はなく、playbook と呼ばれる環境設定の定義を書いた YAML ファイル
さえあれば実行できる。
- 学習コストが比較的低い YAML 形式で設定情報を定義できる。
- モジュールがない機能については shellや command モジュールで実装する必要がでてくる。
- 指示を送るサーバー、指示を受けるサーバーともにPythonが必要。


- Windows クライアントはないため、Windows 上での実行は不可能。実行する為には仮想環境で Linux 環境を用意するしかない。  
- フォルダーの構成(Ansible 公式が薦める構成)がわかりづらい。
- 構文チェック機能がある。

以下を読み取り、Python(プログラミング言語)コードを送信して実行する。  
※1対多のように、複数台のサーバーを一度に処理することが可能  
- Playbook：設定したい内容が書かれている。
- Inventory：対象のホスト情報が書かれている。  

#### 用語
- Inventory  
設定対象のホストなどを管理するファイル。  
- Playbook  
設定したい構成を定義する YAML ファイル。  
- Task  
Playbook の中に書かれた処理の単位。  
- Role  
Ansible の Playbook 分割のベストプラクティス。Ansible Galaxy に公開されているものはこの形式を守っている。  
毎回手動で作るのではなく、一発で作るコマンドがある。  
- Module  
Ansible で使える機能部品のようなもの。モジュールをがある機能の場合、通常の環境構築の時にいれるコマンドより記述が簡潔になる。  

- Dry Run  
できあがった Playbook を対象サーバーへの投入はしないけど実行できる、疑似的な実行。  

### OpsWorks

以下、個人サイトにて記載。  

[OpsWorksについて](https://kakuya07218.xsrv.jp/aws.cloudmemo/2024/02/22/%e8%87%aa%e5%8b%95%e5%8c%96%e3%82%b5%e3%83%bc%e3%83%93%e3%82%b9/#OpsWorks)  

