# lecture4:講義概要
## 【概要】
実際にAWSのGUI画面から基本的なインフラ環境を構築していくステップである。必要最低限な各サービスの役割の概要を理解し、基本的ながらも各サービスがどのような役割を有しており、どのサービスと連携してどのような処理が実現されるかを、部分部分を照らしていってAWSサービスの在り方・使い方を理解する。

## ヒアリング(問診)という定義
構築するために欠かせない値(パラメーター)は、あなたに構築を依頼した人や、あなた自身が考えて決め、これを決定するための確認に対していう。
ヒアリングを行えるようになるまでにはたくさんの用語の理解が必要である。

## AWSサービス説明
### ○VPC(Virtual Private Cloud)
- AWS 内で作成する仮想ネットワーク。
- これがないとネットワークが定義されず、外部との接続どころか内部での通信も出来ない。
※サブネットやインターネットゲートウェイはVPCの作成と同時に自動的に作成される

●サブネット
- VPC内のパーティション的役割。
- ネットワークで定義された IP アドレスの範囲は明確に決まっていて、サブネットはその範囲をさらに細かく分類するもの。
- 「パブリック（WAN）」と「プライベート（LAN）」の二種類がある。

●リージョン
- 「東京」や「オレゴン」などの地域を示す。（ap-northeast-1）

●AZ(Availability Zone)
- リージョンの中にある、さらに分割されたデータセンターの集まりのことで、リージョン名+アルファベット 1 文字が付く。
- Multi-AZ と呼ばれる冗長化構成は、構成を 1 つの AZ に配備するのではなく、複数の AZ にコピーするような構成。

●セキュリティグループ
- TCP/IP を元にしたアクセス制限を行うための設定。

●EC2(Elastic Compute Cloud)
- サーバー向けコンピューターを貸し出すサービス。
- OS が入った状態のほぼ無設定のものが構築される。
- できあがった EC2 へログインするためにキーペアを必ず作ることになる。
- ダウンロードすることで得られるのは秘密鍵と言い、インスタンスの全権限を左右するもの。
- 他人と共有する場合は公開鍵をユーザー毎に作りましょう。
- 小規模用、中規模用、大規模用、ビッグデータ取扱用、のようにさまざまな用途毎に準備されている。
- システムの可用性を高める場合、基本的には EC2 を複数構築してスペックは低めにすることが良い。 
（高スペック 1 台よりメリットが得られます。全ダウンしにくい、料金が安い）

●RDS(Relational Database Service)
- データベースサーバーを貸し出すサービス。
- MySQL か PostgreSQLあたりが多く、Oracle などは商用利用が前提なのと、色々重いため Java などの業務系案件で使われる事が多い。
- どの DB を作るか、マスターユーザー名、パスワードの設定が重要。


## AWSの権限管理
### ○ルートユーザー
AWS アカウント作成で最初に作られるユーザーはと呼ばれ、解約も含めてすべての権限を持つ。
AWS アカウントを作ってルートユーザーでログインしたら、まずは強い権限を持つ管理者アカウントを作り、その後ルートユーザーは利用せず厳格に管理するのが基本。その後は利用目的に応じてユーザーやグループを作り、ポリシーやロールという「権限」を割り当てる。

- MFA(多要素認証)を強制させる必要がある。

●アクセスキーやシークレットキー
- 「マネジメントコンソールにはアクセスできないが、コマンドを使ってのみ AWS のリソースにアクセスできる」という IAM の情報も作成できる。
- バージョン管理システムに登録する場合は暗号化したり、公開範囲をプライベートにするなど、他人に絶対見られないよう保護すること。
- アクセスキーやシークレットアクセスキーはプログラムから利用することが多い為、ついプログラムコードと一緒に Git などのバージョン管理システムに登録したくなるが、世の中には間違えて公開されている認証情報(クレデンシャル)を専門に探して盗み出すBot(ロボット)が存在するため登録は避けるべし。


【注意点】
ルートユーザー情報の流出は甚大な被害であるため原則、現場では利用されない。
IAM を使って、権限の管理や別のユーザーを作成したりする事で、セキュリティ制御を行う。

### ○IAM
●ポリシー【アクセス制御】
- IAM の権限を管理する。このなかには対象の権限やアクション（Allow ＝許可、Deny ＝拒否）、条件式などが書かれている。
- このポリシーをさまざまなものにアタッチ（取り付け）してアクセス制御を行う。

●ユーザー
- 基本的に個人に対して発行する。その他、アプリケーション用などの場合は便宜上の名前を付けて管理するとよい。
- マネジメントコンソールにログイン可否、アクセスキーの所有有無も管理できる。
- ユーザーにはポリシーをアタッチできる。

●グループ
- ユーザーをひとまとめにできる。部署で作ったり、権限グループとして作れる。
- ユーザーは複数のグループに所属ができる（上限あり）。
- ユーザー 1 つ 1 つにポリシーをアタッチすると管理コストが大きいため、グループにアタッチすることが推奨される。
- 「サービス」はポリシーをアタッチすることができず、扱えるのは IAM ロールだけ。

●ロール
- ロールを引き受けると現在時刻から 1 時間だけアクセスキーを貰える。
- 操作を終えたい場合は、サインアウトするか、期限切れを待つことになる。
- もらえるアクセスキーは必ず有効期限付きであるため、流出しても Bot の手に渡った頃には期限切れとになる。
- ロールが使えるのは AWS 内のサービス、および IAM ユーザーのみである。

# 課題_AWS環境を構築してみる
## 【対応事項】
### AWSでEC2とRDSを用いた冗長構成を作成する。
下記リンクを参照したため、特筆事項なし。 
[参考サイト：https://qiita.com/Takao_/items/a55c85996dd6a8a8bb4c]

### 上記課題で作成したAWS環境のインフラ構成図を作成する。
※使用ツール：Cacoo 
![](https://github.com/SMYT-BT/My-initiative/blob/main/OnlineSchool_Raisetech/Raisetech%E8%AA%B2%E9%A1%8C/lecture04/Infrastructure%20configuration%20diagram.png)

