# Webアプリケーションとは
## ■Webアプリケーションとは
インターネット（ウェブ）などのネットワークから利用できるアプリケーションソフトウェアのこと。

基本機能としては、データベースへの接続制御、セキュリティ管理、ユーザー認証処理などの動的な処理が可能。

- Webアプリは、Webサーバー上で動作すること。Webブラウザを使うアプリケーションサーバを指す。
- GoogleやYahooなど普段よく使っているWebブラウザでそのWebアプリを操作することができること。
　→インターネット上で動作するアプリがWebアプリに分類される。
- サーバソフトウェアは、ユーザーとデータベースなどの業務システムをつなげる機能を持っている。

⇒主に企業内の業務システムやオンラインショップの受発注システム、企業間の電子商取引など動的な処理が多く発生するWebサイトで活用されている。

### ◇ネイティブアプリ
アプリ自体をスマートフォンやタブレットにインストールし、端末上のみで作動するアプリのこと。

例えばiTunesStoreやGoogle Playからインストールして、スマートフォンやタブレット上で使用するアプリは全て、ネイティブアプリケーションに分類される。

- 端末へインストールため、写真アプリやゲームはオフラインでも動き、動作が速いのも特徴の一つ。
- デバイス自体が持つプッシュ通知や位置情報などを使った機能を簡単に実装できるのもネイティブアプリのメリット。

### ◇ハイブリッドアプリ
WEBアプリとネイティブアプリの特徴を兼ね備えたアプリ。ブラウザでも端末にインストールしても使用することができる。

例えば、GmailやGoogle Mapsなどはインターネット上でもアプリとしても使用できる。食べログやAmazonもアプリとインターネット上どちらでも使用可能。

## ■主なツール
### ◇プログラミング言語：「フロントエンド言語」と「サーバーサイド言語」の2種類に大きく別ける
- マークアップ言語：文章にタイトルなどの要素を加える
- スタイルシート言語：Webサイトの見た目を整える
- フロントエンド言語：Web上の表面的な部分を作成する
- サーバーサイド言語：Web上の裏側の処理を行う

### ◇Webフレームワーク
主にアプリ開発を効率良く行うための開発専用ツールのこと。

骨組みに機能を追加するだけでアプリやシステムが開発できるようになる。

開発の手間を省くために、機能の元となる部品をある程度用意してくれていたり、簡単に実装できるようにしてくれる。

## ■Webアプリケーションの構造

### ◇フロントエンド（クライアントサイド）：ユーザーの目に見える部分
- Webサイト、サービスの見た目
- 文字の入力やタップできる部分

Webページで使用する言語
- HTML
- CSS
- Javascript

### ◇バックエンド：ユーザーの眼に見えない部分
Webサーバー、データベースサーバ
- サーバーやデータベースの設計、開発や運用業務を含めて「バックエンド」と呼ぶこともある

（※バックエンドをサーバーサイドと呼ぶこともある）

使用する言語
- Ruby
- PHP
- Python

### ◇データベース
検索や蓄積が容易にできるよう整理された情報の集まり。

通常はコンピュータによって実現されたものを指すが、紙の住所録などをデータベースと呼ぶ場合もある。

狭義には、データベース管理システム (Database Management System, DBMS) またはそれが扱う対象のことをいう。


## ▲WebサーバーとWebアプリケーションサーバーの立ち位置

### ◇Webサーバ

WebサイトはユーザーがGoogle ChromeやInternet Explorer、FirefoxといったWebブラウザからリクエストを行う。

例えば、「企業情報を閲覧したい」というリクエスト、アパレル系ECサイトなら「ブランド名やサイズを絞った商品一覧を閲覧したい」といったリクエスト。


Webサーバはリクエストを受け付けると、その結果をWebブラウザへ返す。

会社概要ページなどテキスト情報だけの静的なページであれば、そのままHTML、CSS、画像などのデータを送る。

一方、受け付けた内容がブランド名やサイズを絞るといった動的な処理の場合、WebサーバはWebアプリケーションサーバへ処理のリクエストを依頼し、返ってきた処理をデータとして同じくWebブラウザへ送る。

よく利用されるWebサーバとしては、オープンソースの「Apache HTTP Server」や「nginx」、Microsoftが提供する「Microsoft Internet Information Services (IIS)」などが有名。

### ◇Webアプリケーションサーバ
Webサーバから受け付けたリクエストをJavaやPHP、Rubyなどのプログラミング言語を実行して処理する。そして、実行した結果をWebサーバへと返す。

Javaアプリケーションサーバでは、オープンソースの「Apache Tomcat」が有名。

「Apache Tomcat」はJava Servletを動かすサーブレットコンテナの一つですが、簡単なWebサーバとしての機能も有するため、広く活用されている。


## ■代表的なリソース
### ◇Nginx（Webサーバー）
Webサイトを公開・管理する際に使われるサーバソフトウェア、「Webサーバ」の1種。

（無料でソースコードが紹介されているオープンソースのWebサーバ）

クライアントからのリクエストを受け、なんらかの処理（SSLや圧縮など）を行なうWebサーバ。

Webサーバは他にも種類があるが、Nginxは処理性能や負担軽減面で定評がある。

ただし万能ではないため、競合のWebサーバと比較した欠点も押さえておくと導入の際に役立つ。


※サーバソフトウェア：コンピューターのデータを管理、および処理へ使うための統括的な役割を担うソフトウェア
※開発環境と本番環境の違いはリクエストの数で、unicornはworkerプロセスがせいぜい数個であるのに対し、nginxは数千ものコネクション数が存在

＜メリット＞
- 処理性能に重きが置かれている
- 高い並行処理性能を持つ
- メモリ使用量を抑制できる

⇒「並行処理を行いながらメモリの消費も抑制できる」という設計がNginxの肝

●NginxがApacheより優れている点
- Apacheより処理速度が高い
- メモリ消費量を抑えやすい
- 大量の同時接続処理を素早く処理しやすい


●NginxがApacheより苦手な点

Nginxは特化型なので、汎用型のApacheと比較して苦手な部分もある。
- 動画を多く扱うコンテンツの処理に不向き
- 機能追加がしにくい
- 初心者向けの設定情報が少ない

### ◇Unicorn（アプリケーション用のWebサーバー）
Rack(=Ruby on Railsに等しい)アプリケーション用のWebサーバー。

マルチプロセス（forkを使ったmaster-slave）処理。(※マルチプロセスなのでスレッドセーフは保証される)

〇fork：マスタープロセスがワーカープロセスを生成すること


マスターはアプリケーションのインスタンスを持つ唯一のプロセスで、複数のワーカープロセスを生成し、所有する。

送信されてきた多数のリクエストを捌き、分散してアプリケーションに伝達する。リクエストをアプリケーションへ伝達するとアプリケーションからレスポンスが戻ってくるまで待機し、最終的にリクエストに対するレスポンスをクライアントに返す。

つまりUnicornにおいて処理を裁いているのは、マスタープロセスをフォークしたワーカープロセスが処理している。


masterプロセスがアプリケーションのソースコードを保持。これをforkしたworkerプロセス群が実際のリクエストを処理。

ソースコードをロードするのがmasterプロセスのみであるため、起動が早い。

プロセスごとに通信処理をおこなうため、重たい通信があった場合そこでブロックされて全体が重くなる。

→さばけるようにするにはUnicornのworker数を増やす必要があるが、CPUのコアの数による処理制限があるためむやみに増やせない。


〇ブロッキングI/Oモデル：I/O処理時に対象が準備完了になるまで待機し続けること。


★上記のように大量のアクセスを処理できないため、Nginxが必要

※master-slave のほうが以下のようなメリットがあるとのこと

- メモリ効率が良いかも
- プロセスが死ぬわけではないのでダウンタイムが発生しない
- 結果的にデプロイ時にダウンタイムが発生しない
- デプロイが早い

### ◇弱点
- スロークライアント(リクエストが遅いクライアント) に弱い

スロークライアントが来た場合、workerが待ちのまま止まってしまう。

→そのためNginxなどリバースプロキシを挟んで、スロークライアントをバッファしてもらう必要がある

　これは、Unicornの不具合というより仕様。


### ◇Puma（Webサーバーの一種であり、主にアプリケーションサーバーとされる）
(開発環境に優先される）　マルチスレッド

1つのアプリケーションサーバで複数のRailsプロセスを起動して、処理の効率化を図っている

1プロセスの中でマルチスレッドで動く。

マルチプロセスよりはマルチスレッドの方が一般にパフォーマンスは高い。


マルチスレッドで動くので、プロセスを増やす必要がないため、リソースが少ない中でも効率的にリクエストをさばくことが可能になる。

Pumaは更に、プロセスをマルチスレッド化している。これにより、I/O wait が発生した時に、別スレッドの処理を進められるため、マルチプロセスのみより効率が良い

マルチスレッドということは逆に言うとスレッドセーフな実装をする必要があり、当然使用しているgemもスレッドセーフであることを保証しなければならない。


当初のrailsはマルチスレッドを意識した設計になっていなかったので、無理やりマルチスレッドで動かすとユーザーAのログイン情報をうっかりユーザーBに共有してしまうようなことが起こりうる状況だった。


〇スレッドセーフ：マルチスレッド環境において、あるコンピュータプログラムを複数のスレッドで並行して実行しても、問題が生じない仕様や設計になっていること。

